# Roadmap: Telegram-бот для конвертации стикеров в PNG

Этот документ описывает пошаговый план создания и запуска Telegram-бота, который будет конвертировать полученные от пользователя стикеры в формат PNG и отправлять их обратно.

## [x] Этап 1: Подготовка и проектирование

- [x] **Регистрация бота в Telegram:**
    - [x] Найти в Telegram @BotFather.
    - [x] Создать нового бота с помощью команды `/newbot`.
    - [x] Получить и надежно сохранить токен доступа (API-ключ).

- [x] **Настройка рабочего окружения:**
    - [x] Создать директорию для проекта.
    - [x] Инициализировать систему контроля версий Git (`git init`).
    - [x] Настроить виртуальное окружение для Python (`python -m venv venv`).
    - [x] Создать файл `requirements.txt` для зависимостей.
    - [x] Создать файл `.env` для хранения токена и добавить его в `.gitignore`.

- [x] **Определение пользовательского сценария:**
    - [x] **`/start`:** Приветственное сообщение, объясняющее, как пользоваться ботом.
    - [x] **Отправка стикера:** Пользователь отправляет стикер -> бот отвечает PNG-файлом этого стикера.
    - [x] **Отправка не-стикера:** Пользователь отправляет текст, фото или что-то другое -> бот вежливо просит отправить именно стикер.
    - [x] **`/help`:** Краткая справка по функциональности.

## [x] Этап 2: Разработка базовой логики

- [x] **Установка библиотек:**
    - [x] Установить основную библиотеку для работы с Telegram API: `pip install python-telegram-bot`.
    - [x] Установить библиотеку для конвертации изображений: `pip install Pillow`.
    - [x] Установить библиотеку для работы с `.env` файлами: `pip install python-dotenv`.

- [x] **Основная структура приложения:**
    - [x] Создать главный файл (например, `main.py`).
    - [x] Реализовать загрузку токена из переменных окружения.
    - [x] Инициализировать бота и настроить обработчики (диспетчеры) для команд и сообщений.

- [x] **Реализация обработчиков команд:**
    - [x] Написать функцию для команды `/start`.
    - [x] Написать функцию для команды `/help`.

- [x] **Реализация обработки стикеров:**
    - [x] Создать обработчик, который срабатывает на получение сообщения со стикером.
    - [x] Внутри обработчика:
        - [x] Получить объект стикера из сообщения.
        - [x] Получить его `file_id`.
        - [x] С помощью `file_id` получить путь к файлу (стикеры в Telegram хранятся в формате `.webp`).
        - [x] Скачать файл во временную директорию или в память.

## [x] Этап 3: Конвертация и отправка файла

- [x] **Конвертация изображения:**
    - [x] Используя библиотеку Pillow, открыть скачанный `.webp` файл.
    - [x] Сохранить изображение в формате `.png` во временный файл или в байтовый поток в памяти.

- [x] **Отправка результата пользователю:**
    - [x] Отправить сконвертированный `.png` файл пользователю как документ (`send_document`). Это сохранит прозрачность и качество.
    - [x] Реализовать очистку временных файлов после отправки.

- [x] **Обработка ошибок:**
    - [x] Добавить обработку случаев, когда пользователь отправляет не стикер, а другой тип контента.
    - [x] Добавить логирование ошибок, если скачивание или конвертация не удались.

## [ ] Этап 4: Тестирование и отладка

- [ ] **Модульное тестирование:**
    - [ ] Проверить корректность работы каждой функции в отдельности (по возможности).

- [ ] **Интеграционное тестирование:**
    - [x] Запустить бота локально.
    - [x] Протестировать все пользовательские сценарии:
        - [x] Отправка `/start` и `/help`.
        - [x] Отправка статического стикера.
        - [x] Отправка анимированного стикера (продумать, как бот должен на это реагировать — на первом этапе можно просто игнорировать или сообщать о неподдерживаемом формате).
        - [x] Отправка текстовых сообщений и изображений.

## [ ] Этап 5: Развертывание (Deployment)

- [x] **Выбор хостинга:**
    - [x] Выбрать платформу для круглосуточной работы бота (Render).

- [x] **Подготовка к развертыванию:**
    - [x] Создать `Procfile` (для Render) и настроить WSGI-сервер (если необходимо), если используется вебхук.
    - [x] Убедиться, что все зависимости прописаны в `requirements.txt`.

- [ ] **Развертывание:**
    - [ ] Загрузить код на Render.
    - [ ] Настроить переменные окружения (токен бота, URL вебхука) на Render.
    - [ ] Запустить приложение на Render.

- [x] **Переключение на вебхуки (рекомендуется):**
    - [x] Настроить бота на работу через вебхуки вместо длинных опросов (long polling) для повышения эффективности. Это потребует настройки простого веб-сервера (например, с помощью Flask или FastAPI).

## [ ] Этап 6: Поддержка и развитие

- [x] **Мониторинг:**
    - [x] Настроить систему логирования для отслеживания работы бота и оперативного выявления проблем.

- [ ] **Сбор обратной связи:**
    - [ ] Добавить возможность для пользователей отправить отзыв (например, через специальную команду).

- [ ] **Возможное развитие:**
    - [ ] Поддержка анимированных стикеров (конвертация в GIF).
    - [ ] Возможность скачивать целые стикерпаки.
    - [ ] Создание кнопок с быстрым доступом к командам.
    - [ ] Локализация бота на несколько языков.
